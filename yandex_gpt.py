import os
import aiohttp
import random
from typing import Optional

class YandexGPT:
    def __init__(self):
        self.facts_db = {
            "ri": {  # Российская Империя (базовый уровень)
                1721: {
                    "basic": "1721 год: Пётр I принял титул императора, Россия официально стала империей.",
                    "medium": "1721 год: После победы в Северной войне Пётр I принял титул императора. Это событие ознаменовало превращение России в империю. Сенат и Синод торжественно присвоили Петру титул «Отца Отечества, Императора Всероссийского, Петра Великого». Это изменение отражало новый статус России как одной из ведущих европейских держав.",
                    "advanced": "1721 год: Провозглашение России империей стало кульминацией петровских преобразований. После победы в Северной войне (1700-1721) Россия получила выход к Балтийскому морю и стала одной из сильнейших держав Европы. Пётр I получил титул императора, что уравняло его статус с другими европейскими монархами. Этому предшествовала масштабная реформаторская деятельность: создание регулярной армии и флота, реформа государственного управления, церковная реформа, развитие промышленности и торговли. Особое значение имело строительство Санкт-Петербурга (с 1703 года), который стал символом новой России. Империя распространила своё влияние от Балтики до Тихого океана, заложив основы для дальнейшей экспансии в XVIII-XIX веках."
                },
                1812: {
                    "basic": "1812 год: Отечественная война, Бородинское сражение.",
                    "medium": "1812 год: Вторжение армии Наполеона в Россию. Бородинское сражение стало крупнейшей битвой Отечественной войны. Французская армия численностью более 130 тысяч человек противостояла русской армии под командованием М.И. Кутузова. Сражение длилось 12 часов и привело к значительным потерям с обеих сторон.",
                    "advanced": "1812 год: Отечественная война стала поворотным моментом в истории России и Европы. Наполеоновская армия, численностью более 600 тысяч человек, вторглась в Россию 12 июня. Русская армия применила тактику отступления, изматывая противника. Бородинское сражение 7 сентября стало кульминацией войны: 130-тысячная французская армия против 120-тысячной русской. Битва длилась 12 часов, погибло около 100 тысяч человек. Хотя сражение не выявило явного победителя, оно подорвало боевой дух французской армии. Последовавшие решения Кутузова об оставлении Москвы и Тарутинский манёвр привели к катастрофическому отступлению армии Наполеона. Война способствовала росту национального самосознания и патриотизма, определила внешнеполитическое могущество России на десятилетия вперёд."
                }
            },
            "ussr": {
                1941: {
                    "basic": "1941 год: Начало Великой Отечественной войны.",
                    "medium": "1941 год: 22 июня нацистская Германия вероломно напала на СССР. Началась Великая Отечественная война. В первые месяцы войны Красная Армия понесла тяжёлые потери и была вынуждена отступать. Однако героическая оборона Брестской крепости, Ленинграда, Киева и других городов замедлила продвижение врага.",
                    "advanced": "1941 год: Начало Великой Отечественной войны оказалось трагическим для СССР. 22 июня в 4 часа утра немецкие войска без объявления войны перешли границу СССР. План 'Барбаросса' предусматривал молниеносную войну и захват территории до линии Архангельск-Астрахань за 6-8 недель. Против СССР было брошено 190 дивизий (5,5 млн человек), 4300 танков, 47 тысяч орудий и миномётов, 4980 самолётов. В первые дни войны было уничтожено около 1200 советских самолётов. К концу года враг захватил Прибалтику, Белоруссию, Украину, блокировал Ленинград. Однако план блицкрига провалился благодаря героическому сопротивлению советского народа, эвакуации промышленности на восток (было перемещено более 1500 предприятий), мобилизации всех ресурсов страны. Битва за Москву в декабре 1941 года стала первым крупным поражением вермахта во Второй мировой войне."
                }
            },
            "rf": {
                1991: {
                    "basic": "1991 год: Образование Российской Федерации.",
                    "medium": "1991 год: После событий августовского путча и подписания Беловежских соглашений СССР прекратил существование. Россия стала независимым государством, начался период радикальных экономических реформ под руководством Б.Н. Ельцина.",
                    "advanced": "1991 год: Образование Российской Федерации стало результатом сложных политических процессов конца 1980-х - начала 1990-х годов. После неудачной попытки государственного переворота ГКЧП 19-21 августа 1991 года, когда консервативная часть руководства СССР попыталась остановить процессы децентрализации, последовал запрет КПСС и ускорение распада Советского Союза. 8 декабря 1991 года в Беловежской пуще руководители России, Украины и Белоруссии подписали соглашения о прекращении существования СССР и создании СНГ. 25 декабря М.С. Горбачёв сложил полномочия президента СССР. Россия унаследовала международные обязательства СССР, место в Совете Безопасности ООН и ядерный арсенал. Начался период радикальных рыночных реформ, включавших либерализацию цен, приватизацию государственной собственности, что привело к глубоким социально-экономическим изменениям в обществе. Была принята Декларация о государственном суверенитете РСФСР, начала формироваться новая политическая система."
                }
            }
        }

    async def generate_history_fact(self, epoch: str, year: Optional[int], difficulty: str) -> str:
        if epoch not in self.facts_db:
            return "Извините, для данной эпохи факты отсутствуют."

        if year and year in self.facts_db[epoch]:
            return self.facts_db[epoch][year][difficulty]

        # Если год не указан или для него нет факта, возвращаем случайный факт
        available_years = list(self.facts_db[epoch].keys())
        random_year = random.choice(available_years)
        return self.facts_db[epoch][random_year][difficulty]