
import os
import aiohttp
import random
from typing import Optional

class YandexGPT:
    def __init__(self):
        self.facts_db = {
            "ri": {  # Российская Империя (базовый уровень)
                1721: "Пётр I принял титул императора, Россия официально стала империей.",
                1725: "Начало правления Екатерины I, первой женщины-императрицы.",
                1730: "Анна Иоанновна взошла на престол.",
                1741: "Елизавета Петровна стала императрицей.",
                1755: "Основан Московский университет по инициативе М.В. Ломоносова.",
                1762: "Начало правления Екатерины II.",
                1773: "Восстание Емельяна Пугачёва.",
                1790: "Взятие Измаила А.В. Суворовым.",
                1799: "Итальянский и Швейцарский походы Суворова.",
                1812: "Бородинское сражение - крупнейшая битва Отечественной войны.",
                1825: "Восстание декабристов на Сенатской площади.",
                1837: "Открытие первой в России железной дороги.",
                1861: "Отмена крепостного права.",
                1870: "Основание Товарищества передвижных выставок.",
                1880: "Открытие памятника А.С. Пушкину в Москве.",
                1891: "Начало строительства Транссибирской магистрали.",
                1904: "Начало Русско-японской войны.",
                1914: "Вступление России в Первую мировую войну."
            },
            "ussr": {  # СССР (базовый уровень)
                1922: "Образование СССР.",
                1924: "Смерть В.И. Ленина, принятие первой конституции СССР.",
                1928: "Начало первой пятилетки.",
                1934: "СССР вступил в Лигу Наций.",
                1936: "Принятие новой Конституции СССР.",
                1941: "Начало Великой Отечественной войны.",
                1943: "Курская битва.",
                1945: "Победа в Великой Отечественной войне.",
                1949: "Создание ядерного оружия в СССР.",
                1953: "Смерть И.В. Сталина.",
                1956: "XX съезд КПСС, разоблачение культа личности.",
                1957: "Запуск первого искусственного спутника Земли.",
                1961: "Первый полёт человека в космос.",
                1964: "Отставка Н.С. Хрущёва.",
                1977: "Принятие новой Конституции СССР.",
                1985: "Начало Перестройки.",
                1986: "Авария на Чернобыльской АЭС.",
                1991: "Распад СССР."
            },
            "rf": {  # РФ (базовый уровень)
                1991: "Образование Российской Федерации.",
                1993: "Принятие действующей Конституции РФ.",
                1996: "Первые выборы президента РФ.",
                1998: "Дефолт и экономический кризис.",
                2000: "Избрание В.В. Путина президентом.",
                2004: "Реформа социальных льгот.",
                2006: "Выплата внешнего долга СССР.",
                2008: "Избрание Д.А. Медведева президентом.",
                2014: "Присоединение Крыма.",
                2016: "Выборы в Государственную Думу.",
                2018: "Чемпионат мира по футболу.",
                2020: "Принятие поправок к Конституции."
            }
        }

        # Добавляем углубленные факты для каждой эпохи
        self.advanced_facts = {
            "ri": {
                "basic": "Основные события и даты российской истории.",
                "medium": "Детали реформ, войн и культурных изменений.",
                "advanced": "Углубленный анализ исторических процессов и их влияния."
            },
            "ussr": {
                "basic": "Ключевые события советской эпохи.",
                "medium": "Экономические и социальные преобразования.",
                "advanced": "Комплексный анализ советского периода."
            },
            "rf": {
                "basic": "Современная история России.",
                "medium": "Политические и экономические процессы.",
                "advanced": "Детальный разбор современных реформ."
            }
        }

    async def generate_history_fact(self, epoch: str, year: Optional[int], difficulty: str) -> str:
        if epoch not in self.facts_db:
            return "Извините, для данной эпохи факты отсутствуют."

        fact = ""
        if year and year in self.facts_db[epoch]:
            fact = self.facts_db[epoch][year]
            
            # Добавляем дополнительную информацию в зависимости от уровня сложности
            if difficulty == "medium":
                fact += f"\n\nДополнительно: {self.advanced_facts[epoch]['medium']}"
            elif difficulty == "advanced":
                fact += f"\n\nУглубленный анализ: {self.advanced_facts[epoch]['advanced']}"
                
            return fact

        # Если год не указан или для него нет факта, возвращаем случайный факт
        available_facts = list(self.facts_db[epoch].values())
        fact = random.choice(available_facts)
        
        if difficulty == "medium":
            fact += f"\n\nДополнительно: {self.advanced_facts[epoch]['medium']}"
        elif difficulty == "advanced":
            fact += f"\n\nУглубленный анализ: {self.advanced_facts[epoch]['advanced']}"
            
        return fact
